<% unless URI(request.original_url).path.starts_with?('/admin') %>
  <!-- BEGIN: Google Trusted Stores -->
  <script type="text/javascript">
    var gts = gts || [];

    gts.push(["id", "<%= local_assigns[:id] || '000000' %>"]);
    gts.push(["locale", "<%= local_assigns[:locale] || 'en_US' %>"]);

    <% if Spree::GoogleShoppingSetting.instance.use_google_shopping? %>
      <% if (product = valid_prominent_product) && product.offer_id && !product.offer_id.empty? %>
        gts.push(["google_base_offer_id", "<%= product.offer_id %>"]);
      <% end %>
      gts.push(["google_base_subaccount_id", "<%= Spree::GoogleShoppingSetting.instance.merchant_id %>"]);
      gts.push(["google_base_country", "<%= product.try(:target_country) || 'US' %>"]);
      gts.push(["google_base_language", "<%= product.try(:content_language) || 'en' %>"]);
    <% end %>

    (function() {
      var scheme = (("https:" == document.location.protocol) ? "https://" : "http://");
      var gts = document.createElement("script");
      gts.type = "text/javascript";
      gts.async = true;
      gts.src = scheme + "www.googlecommerce.com/trustedstores/gtmp_compiled.js";
      var s = document.getElementsByTagName("script")[0];
      <% if Rails.env.production? %>
        s.parentNode.insertBefore(gts, s);
      <% else %>
        // s.parentNode.insertBefore(gts, s);
      <% end %>
    })();
  </script>
  <!-- END: Google Trusted Stores -->
<% end %>
